import { Component, OnInit } from '@angular/core';
import { CommonModule } from '@angular/common';
import { FormsModule } from '@angular/forms';
import { IonicModule, NavController } from '@ionic/angular';
import { ActivatedRoute } from '@angular/router';
import { TeacherService } from '../../services/teacher.service';
import { Teacher } from '../../models/teacher.dto';

@Component({
  selector: 'app-teacher-form',
  templateUrl: './teacher-form.page.html',
  styleUrls: ['./teacher-form.page.scss'],
  standalone: true,
  imports: [CommonModule, FormsModule, IonicModule],
})
export class TeacherFormPage implements OnInit {
  teacher: Teacher = {
    id: 0,
    firstName: '',
    lastName: '',
    title: '',
    courses: []
  };
  isEditMode = false;
  errorMessage = '';

  constructor(
    private teacherService: TeacherService,
    private route: ActivatedRoute,
    private navCtrl: NavController
  ) {}

  ngOnInit(): void {
    const teacherId = Number(this.route.snapshot.paramMap.get('id'));
    if (teacherId) {
      this.isEditMode = true;
      this.loadTeacher(teacherId);
    }
  }

  loadTeacher(id: number): void {
    this.teacherService.getById(id).subscribe({
      next: (data) => this.teacher = data,
      error: (err) => {
        console.error('Error loading teacher:', err);
        this.errorMessage = 'Failed to load teacher.';
      }
    });
  }

  save(): void {
    this.teacherService.upsert(this.teacher).subscribe({
      next: () => this.navCtrl.back(),
      error: (err) => {
        console.error('Error saving teacher:', err);
        this.errorMessage = 'Failed to save teacher.';
      }
    });
  }
}
